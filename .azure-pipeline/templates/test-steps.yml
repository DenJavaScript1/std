parameters:
  win: 'false'

steps:
  - script: npm install eslint typescript@$(TS_VERSION) @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-config-prettier
  # Linux and Mac
  - ${{ if eq(parameters.win, 'false') }}:
    - script: curl -L https://deno.land/x/install/install.sh | sh -s $(DENO_VERSION)
    - bash: echo "##vso[task.prependpath]$(HOME)/.deno/bin/"
  # Windows
  - ${{ if eq(parameters.win, 'true') }}:
    - powershell: iwr https://deno.land/x/install/install.ps1 -out install.ps1; .\install.ps1 $(DENO_VERSION)
    - bash: echo "##vso[task.prependpath]C:\Users\VssAdministrator\.deno\\bin"
  - bash: npx eslint **/*.ts --max-warnings=0
  - bash: deno.exe run --allow-run --allow-write --allow-read format.ts --check
  - bash: deno.exe run --allow-run --allow-net --allow-write --allow-read --config=tsconfig.test.json test.ts
